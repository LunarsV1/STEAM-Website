<!DOCTYPE html>
<html>
<head>
    <title>Flappy Bird</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; background: #70c5ce; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const bird = {
            x: 50,
            y: 150,
            width: 34,
            height: 24,
            gravity: 0.6,
            lift: -15,
            velocity: 0,
            frame: 0,
            sprite: new Image(),
            show: function() {
                if (this.sprite.complete && this.sprite.naturalHeight !== 0) {
                    const frameX = (this.frame % 3) * this.width;
                    ctx.drawImage(this.sprite, frameX, 0, this.width, this.height, this.x, this.y, this.width, this.height);
                } else {
                    ctx.fillStyle = 'yellow';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            },
            update: function() {
                this.velocity += this.gravity;
                this.velocity *= 0.9; // Add some damping to smooth the movement
                this.y += this.velocity;
                if (this.y > canvas.height - this.height) {
                    this.y = canvas.height - this.height;
                    this.velocity = 0;
                }
                if (this.y < 0) {
                    this.y = 0;
                    this.velocity = 0;
                }
                this.frame++;
            },
            up: function() {
                this.velocity = this.lift; // Reset velocity for a more consistent flap
            }
        };
        bird.sprite.src = 'https://i.imgur.com/4LGAZ8t.png'; // Animated bird sprite

        const obstacles = [];
        const obstacleWidth = 50;
        const obstacleGap = 200;
        const obstacleFrequency = 90; // Frames between obstacles
        const obstacleSprite = new Image();
        obstacleSprite.src = 'https://i.imgur.com/5z6l1Gf.png'; // New pillar sprite

        const background = new Image();
        background.src = 'https://i.imgur.com/3X7j4gG.png'; // Background image

        let score = 0;

        function createObstacle() {
            const height = Math.random() * (canvas.height / 2);
            obstacles.push({
                x: canvas.width,
                y: 0,
                width: obstacleWidth,
                height: height,
                sprite: obstacleSprite,
                passed: false
            });
            obstacles.push({
                x: canvas.width,
                y: height + obstacleGap,
                width: obstacleWidth,
                height: canvas.height - height - obstacleGap,
                sprite: obstacleSprite,
                passed: false
            });
        }

        function updateObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].x -= 2;
                if (obstacles[i].x + obstacleWidth < 0) {
                    obstacles.splice(i, 1);
                }
                if (!obstacles[i].passed && obstacles[i].x + obstacleWidth < bird.x) {
                    obstacles[i].passed = true;
                    score++;
                }
            }
        }

        function drawObstacles() {
            for (let obstacle of obstacles) {
                if (obstacle.sprite.complete && obstacle.sprite.naturalHeight !== 0) {
                    ctx.drawImage(obstacle.sprite, obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                } else {
                    ctx.fillStyle = 'green';
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                }
            }
        }

        function checkCollision() {
            for (let obstacle of obstacles) {
                if (bird.x < obstacle.x + obstacle.width &&
                    bird.x + bird.width > obstacle.x &&
                    bird.y < obstacle.y + obstacle.height &&
                    bird.y + bird.height > obstacle.y) {
                    return true;
                }
            }
            return false;
        }

        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space' && !gameOver) {
                bird.up();
            } else if (event.code === 'Space' && gameOver) {
                restartGame();
            }
        });

        let frameCount = 0;
        let gameOver = false;

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(background, 0, 0, canvas.width, canvas.height);

            if (!gameOver) {
                bird.show();
                bird.update();
                if (frameCount % obstacleFrequency === 0) {
                    createObstacle();
                }
                updateObstacles();
                drawObstacles();
                if (checkCollision()) {
                    gameOver = true;
                }
                ctx.fillStyle = 'white';
                ctx.font = '24px sans-serif';
                ctx.fillText('Score: ' + score, 10, 30);
                frameCount++;
            } else {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '48px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2 - 20);
                ctx.font = '24px sans-serif';
                ctx.fillText('Press Space to Restart', canvas.width / 2, canvas.height / 2 + 20);
            }

            requestAnimationFrame(draw);
        }

        function restartGame() {
            bird.x = 50;
            bird.y = 150;
            bird.velocity = 0;
            obstacles.length = 0;
            frameCount = 0;
            score = 0;
            gameOver = false;
        }

        draw();
    </script>
</body>
</html>
